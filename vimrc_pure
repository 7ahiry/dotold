execute pathogen#infect()
syntax on
filetype plugin indent on
filetype plugin on

" tab options
set nocompatible
set modelines=0
set tabstop=4
set shiftwidth=4
set softtabstop=4
set expandtab

" make things look better
set encoding=utf-8
set scrolloff=3
set autoindent
set showmode
set showcmd
set hidden
set wildmenu
set wildmode=list:longest
set visualbell
set cursorline
set ttyfast
set ruler
set backspace=indent,eol,start
set laststatus=2
set relativenumber
let mapleader = ","

" Searching and moving
nnoremap / /\v
vnoremap / /\v
set ignorecase
set smartcase
set gdefault
set incsearch
set showmatch
set hlsearch
nnoremap <leader><space> :noh<cr>
nnoremap <silent> <Space> :nohlsearch<Bar>:echo<CR>
nnoremap <tab> %
vnoremap <tab> %

"Handle long lines correctly
set wrap
set textwidth=79
set formatoptions=qrn1
set colorcolumn=85

" force yourself to use navigation keys
nnoremap <up> <nop>
nnoremap <down> <nop>
nnoremap <left> <nop>
nnoremap <right> <nop>
inoremap <up> <nop>
inoremap <down> <nop>
inoremap <left> <nop>
inoremap <right> <nop>
nnoremap j gj
nnoremap k gk

" remove help from F1 key
inoremap <F1> <ESC>
nnoremap <F1> <ESC>
vnoremap <F1> <ESC>



"Gundo and other stuffs
nnoremap ,0 :GundoToggle<CR>
nnoremap ,9 :NERDTreeToggle<CR>
nnoremap ,8 :GitGutterLineHighlightsToggle<CR>
nnoremap ,7 :Thumbnail<CR>
nnoremap ,6 :Scratch<CR>
:set pastetoggle=<F10>
map <F6> <Esc>:setlocal spell spelllang=en<CR>
map <F7> <Esc>:setlocal spell spelllang=fr<CR>
map <F8> <Esc>z=
map <F9> <Esc>:setlocal nospell<CR>
map <F5> <Esc>:LLPStartPreview<CR>


" PLugin, bundle configuration
let g:airline#extensions#tabline#enabled = 1
let g:airline_powerline_fonts = 1
let g:airline#extensions#tabline#left_sep = ' '
let g:airline#extensions#tabline#left_alt_sep = '|'
set laststatus=2

" ---- MUTT ---- "
au BufRead /tmp/mutt-* set tw=72
au BufRead /tmp/mutt-* setlocal fo+=aw


" GUI options
:set guioptions-=m  "remove menu bar
:set guioptions-=T  "remove toolbar
:set guioptions-=r  "remove right-hand scroll bar
:set guioptions-=L  "remove left-hand scroll bar

" fold
set foldmethod=indent   
set foldnestmax=10
set nofoldenable

" Undo
set undofile                " Save undo's after file closes
set undodir=/home/tah/.vim/undo " where to save undo histories
set undolevels=1000         " How many undos
set undoreload=10000        " number of lines to save for undo
set foldlevel=5

"swap files
set dir=~/.vim/swap//,/var/tmp//,/tmp//,.

" color scheme
"syntax enable
"set background=dark
"colorscheme base16-default

" Search highlight
:highlight Search ctermfg=black
:highlight Search guifg=black
:highlight Normal ctermfg=white guibg=black
nnoremap <silent> n   n:call HLNext(0.4)<cr>
nnoremap <silent> N   N:call HLNext(0.4)<cr>
    " EITHER blink the line containing the match...
    function! HLNext (blinktime)
        set invcursorline
        redraw
        exec 'sleep ' . float2nr(a:blinktime * 1000) . 'm'
        set invcursorline
        redraw
    endfunction

exec "set listchars=tab:\uBB\uBB,trail:\uB7,nbsp:~"
set list

" escape key
inoremap ,, <Esc>
noremap <silent> <c-u> :call smooth_scroll#up(&scroll, 0, 2)<CR>
noremap <silent> <c-d> :call smooth_scroll#down(&scroll, 0, 2)<CR>
noremap <silent> <c-b> :call smooth_scroll#up(&scroll*2, 0, 4)<CR>
noremap <silent> <c-f> :call smooth_scroll#down(&scroll*2, 0, 4)<CR>

" vim-easymotion                                                             
let g:EasyMotion_do_mapping = 0 " Disable default mappings                   
nmap <Leader>s <Plug>(easymotion-s)
nmap <Leader>t <Plug>(easymotion-s2)
let g:EasyMotion_smartcase = 1

"insearch                                                                      
map /  <Plug>(incsearch-forward)
map ?  <Plug>(incsearch-backward)
map g/ <Plug>(incsearch-stay)

" vim-latex-live-preview
let g:livepreview_previewer = 'zathura'

" git auto commit on save
" autocmd BufWritePost * let message = input('Message? ', 'Auto-commit: saved ' . expand('%')) | execute ':silent ! if git rev-parse --git-dir > /dev/null 2>&1 ; then git add % ; git commit -m ' . shellescape(message, 1) . '; fi > /dev/null 2>&1'
"autocmd BufWritePost * let message = input('Message? ', '') | execute ':silent ! if git rev-parse --git-dir > /dev/null 2>&1 ; then git add % ; git commit -m ' . shellescape(message, 1) . '; fi > /dev/null 2>&1'

autocmd BufWritePost * call AutoGitCommit()
function! AutoGitCommit()
  call system('git rev-parse --git-dir > /dev/null 2>&1')
  if v:shell_error
    return
  endif
  "let message = input('Message? ', 'Auto-commit: saved ' . expand('%'))
  let message = input('Commit message? ', '')
  call system('git add ' . expand('%:p'))
  call system('git commit -m ' . shellescape(message, 1))
endfun
